---
import { HtmlPreview, BackToTop } from "@/components";
import { BaseLayout } from "@/layouts";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

// const posts = (await getCollection('posts')).sort(
// 	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
// );


export const getStaticPaths = (async ({paginate}) => {
  const posts = (await getCollection('posts')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
  return paginate(posts, { pageSize: 5 });
}) satisfies GetStaticPaths;

const {page} = Astro.props;
console.log({page});
---

<BaseLayout>
  <section class="max-w-[768px] mx-auto p-6 flex flex-col gap-6">
      {
        page.data.map((post) => (
          <article class="bg-white p-6 rounded-md">
            <a href={`/posts/${post.id}`}>
            {post.data.cover?.image &&(
              <Image class="rounded-md" width={720} height={360} src={post.data.cover.image} alt={post.data.title} />
            )}
            {post.data.preview?.enabled && (
              <HtmlPreview postId={post.id} height={post.data.preview?.height} />
            )}
            <h4 class="text-lg font-bold mt-6">{post.data.title}</h4>

            <p class="text-sm text-gray-500 mt-2">{post.data.description}</p>
            <p class="text-sm text-gray-500 mt-4">{post.data.date.toLocaleDateString()}</p>
            </a>
          </article>
        ))
      }
  </section>

  <!-- 分页导航 -->
  <nav class="flex justify-center items-center gap-2 mt-8 mb-6" aria-label="分页">
    {
      page.url.prev ? (
        <a 
          href={`${page.url.prev}`}
          class="px-5 py-2.5 rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-blue-50 hover:border-blue-500 hover:text-blue-600 transition-all duration-200 shadow-sm hover:shadow-md font-medium"
        >
          ← 上一页
        </a>
      ) : (
        <span class="px-5 py-2.5 rounded-lg border border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed font-medium">
          ← 上一页
        </span>
      )
    }

    {/* 页码显示 */}
    <div class="flex items-center gap-1 mx-4 px-4 py-2 bg-gray-50 rounded-lg border border-gray-200">
      <span class="text-sm text-gray-600 font-medium">
        第 {page.currentPage} / {page.lastPage} 页
      </span>
    </div>

    {
      page.url.next ? (
        <a 
          href={`${page.url.next}`}
          class="px-5 py-2.5 rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-blue-50 hover:border-blue-500 hover:text-blue-600 transition-all duration-200 shadow-sm hover:shadow-md font-medium"
        >
          下一页 →
        </a>
      ) : (
        <span class="px-5 py-2.5 rounded-lg border border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed font-medium">
          下一页 →
        </span>
      )
    }
  </nav>
  
  <BackToTop />
</BaseLayout>
